.. _mps_environment_variables:

متغيرات بيئة MPS
=============

**متغيرات بيئة PyTorch**

.. list-table::
  :header-rows: 1

  * - المتغير
    - الوصف
  * - ``PYTORCH_DEBUG_MPS_ALLOCATOR``
    - إذا تم تعيينه على ``1``، قم بضبط مستوى تسجيل مخصص الذاكرة إلى مفصل.
  * - ``PYTORCH_MPS_LOG_PROFILE_INFO``
    - قم بضبط خيارات السجل bitmask إلى ``MPSProfiler``. راجع enum ``LogOptions`` في `aten/src/ATen/mps/MPSProfiler.h` للاطلاع على الخيارات المتاحة.
  * - ``PYTORCH_MPS_TRACE_SIGNPOSTS``
    - قم بضبط خيارات الملف الشخصي bitmask وsignpost إلى ``MPSProfiler``. راجع enums ``ProfileOptions`` و ``SignpostTypes`` في `aten/src/ATen/mps/MPSProfiler.h` للاطلاع على الخيارات المتاحة.
  * - ``PYTORCH_MPS_HIGH_WATERMARK_RATIO``
    - نسبة العلامة المائية العليا لمخصص MPS. افتراضيًا، يتم تعيينه على 1.7.
  * - ``PYTORCH_MPS_LOW_WATERMARK_RATIO``
    - نسبة العلامة المائية الدنيا لمخصص MPS. افتراضيًا، يتم تعيينه على 1.4 إذا كانت الذاكرة موحدة وعلى 1.0 إذا كانت الذاكرة منفصلة.
  * - ``PYTORCH_MPS_FAST_MATH``
    - إذا تم تعيينه على ``1``، قم بتمكين العمليات الحسابية السريعة لنواة MPS المعدنية. راجع القسم 1.6.3 في https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf للاطلاع على الآثار المترتبة على الدقة.
  * - ``PYTORCH_MPS_PREFER_METAL``
    - إذا تم تعيينه على ``1``، قم بإجبار استخدام نوى المعدن بدلاً من استخدام MPS Graph APIs. في الوقت الحالي، يتم استخدام هذا الخيار فقط لعمليات الضرب في المصفوفات.
  * - ``PYTORCH_ENABLE_MPS_FALLBACK``
    - إذا تم تعيينه على ``1``، قم بإرجاع العمليات مرة أخرى إلى وحدة المعالجة المركزية عندما لا تدعمها MPS.

.. note::

    **نسبة العلامة المائية العليا** هي حد أقصى صارم لإجمالي المخصصات المسموح بها

    - `0.0` : تعطيل حد العلامة المائية العليا (قد يتسبب في فشل النظام إذا حدث عوز الذاكرة على مستوى النظام)
    - `1.0` : الحد الأقصى الموصى به لحجم المخصصات (أي device.recommendedMaxWorkingSetSize)
    - `>1.0`: يسمح بالحدود التي تتجاوز device.recommendedMaxWorkingSetSize

    على سبيل المثال، تعني القيمة 0.95 أننا نقوم بتخصيص ما يصل إلى 95% من الحد الأقصى الموصى به
    حجم المخصصات؛ بعد ذلك، ستفشل التخصيصات بخطأ OOM.

    **نسبة العلامة المائية الدنيا** هي حد ناعم لمحاولة الحد من تخصيص الذاكرة إلى مستوى العلامة المائية المنخفضة
    عن طريق جمع القمامة أو الالتزام بمخازن الأوامر بشكل أكثر تكرارًا (المعروف باسم الالتزام التكيفي).
    القيمة بين 0 إلى m_high_watermark_ratio (يؤدي تعيين 0.0 إلى تعطيل الالتزام التكيفي وجمع القمامة)
    على سبيل المثال، تعني القيمة 0.9 أننا "نحاول" الحد من التخصيصات إلى 90% من الحد الأقصى الموصى به
    حجم المخصصات.